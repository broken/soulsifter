<script>

var instances = [];
var data = {};

/**
 * -- Gobal variables
 * bpm: current active bpm
 * song: current active song
 * playmusic: play music instance
 *
 * -- Iron signals
 * playlists-changed:: element notifying playlist-list about change in the playlists
 * save-song-trail:playlist: playlist-edit notifies song-section to save the song trail as a new playlist
 * search:: instigate a search by the song-list
 */
var GlobalBehavior = {
  
  properties: {
    global: {
      type: Object,
      notify: true,
      value: data
    }
  },
  
  ready: function() {
    var _setOrig = this.set;
    var _notifyPathOrig = this.notifyPath;
    this.set = function() {
      _setOrig.apply(this, arguments);
      var path = arguments[0];
      if (typeof path === 'string') {
        path = path.split('.');
      }
      if (path[0] === 'global') {
        this.invokeInstances(_notifyPathOrig, arguments);
      }
    };
    this.notifyPath = function() {
      _notifyPathOrig.apply(this, arguments);
      var path = arguments[0];
      if (typeof path === 'string') {
        path = path.split('.');
      }
      if (path[0] === 'global') {
        this.invokeInstances(_notifyPathOrig, arguments);
      }
    };
  },
  
  invokeInstances: function(fn, args) {
    var instance;
    for (instance of instances) {
      if (instance !== this) {
        fn.apply(instance, args);
      }
    }
  },
  
  attached: function() {
    instances.push(this);
  },
  
  detached: function() {
    var i = instances.indexOf(this);
    if (i >= 0) {
      instances.splice(i, 1);
    }
  }
};

</script>