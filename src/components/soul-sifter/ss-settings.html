<link href="../polymer/polymer.html" rel="import">

<link href="../iron-flex-layout/iron-flex-layout.html" rel="import">
<link href="../paper-checkbox/paper-checkbox.html" rel="import">
<link href="../paper-input/paper-input.html" rel="import">

<link href="abstract-action-page.html" rel="import">


<dom-module id="ss-settings">
  <style is="custom-style">
  </style>
  <template>
    <abstract-action-page id="abstractActionPage">
      <div class="fields">
        <paper-input label="Music Directory" value="{{musicDir}}"></paper-input>
        <paper-input label="Music Video Directory" value="{{musicVideoDir}}"></paper-input>
        <br>
        <paper-input label="Google Music Email" value="{{googleEmail}}"></paper-input>
        <paper-input label="Google Music App Key" value="{{googleAppKey}}"></paper-input>
        <br>
        <paper-input label="Default song list limit" value="{{songListLimit}}" allowedPattern="[0-9]*" preventInvalidInput></paper-input>
        <paper-checkbox checked="{{overwriteSongFromTag}}">Overwrite values when reading ID3 tags</paper-checkbox>
      </div>
      <div class="fields">
        <paper-input label="Database Name" value="{{dbName}}"></paper-input>
        <paper-input label="Database User" value="{{dbUser}}"></paper-input>
        <paper-input label="Database Password" value="{{dbPassword}}"></paper-input>
        <paper-input label="Database URL" value="{{dbUrl}}"></paper-input>
      </div>
    </abstract-action-page>
  </template>
</dom-module>

<script>

  Polymer({
    is: 'ss-settings',

    ready: function() {
      this.settings = new ss.SoulSifterSettings();
      this.musicDir = this.settings.getString('music.dir');
      this.musicVideoDir = this.settings.getString('mv.dir');
      this.googleAppKey = this.settings.getString('google.appKey');
      this.googleEmail = this.settings.getString('google.email');
      this.dbName = this.settings.getString('db.name');
      this.dbUser = this.settings.getString('db.user');
      this.dbPassword = this.settings.getString('db.password');
      this.dbUrl = this.settings.getString('db.url');
      this.songListLimit = this.settings.getInt('songList.limit');
      this.overwriteSongFromTag = this.settings.getBool('tag.readOverwrite');
      this.overwriteSongFromTagOriginalValue = this.overwriteSongFromTag;
    },

    attached: function() {
      // https://www.polymer-project.org/1.0/docs/migration.html#domready
      this.async(function() {
        this.$.abstractActionPage.setAcceptAction(this.save);
      }.bind(this));
    },

    save: function(e, detail, sender) {
      this.puts('music.dir', this.musicDir);
      this.puts('mv.dir', this.musicVideoDir);
      this.puts('google.appKey', this.googleAppKey);
      this.puts('google.email', this.googleEmail);
      this.puts('db.name', this.dbName);
      this.puts('db.user', this.dbUser);
      this.puts('db.password', this.dbPassword);
      this.puts('db.url', this.dbUrl);
      this.puti('songList.limit', this.songListLimit);
      this.putb('tag.readOverwrite', this.overwriteSongFromTag, this.overwriteSongFromTagOriginalValue);
      this.settings.save();
    },

    puts: function(key, value) {
      if (!!key && !!value) {
        this.settings.putString(key, value);
      }
    },

    puti: function(key, value) {
      if (!!key && (!!value || value === 0)) {
        this.settings.putInt(key, value);
      }
    },

    putb: function(key, value, originalValue) {
      if (!!key && value !== originalValue) {
        this.settings.putBool(key, value);
      }
    },
  });
</script>
