<link href="../polymer/polymer.html" rel="import">

<link href="../core-style/core-style.html" rel="import">
<link href="../paper-slider/paper-slider.html" rel="import">

<link href="global-state.html" rel="import">
<link href="themes.html" rel="import">


<polymer-element name="pitch-slider" attributes="maxBpm minBpm pitch pitchPctMax">

  <template>
    <core-style ref="main"></core-style>

    <global-state values="{{global}}"></global-state>

    <paper-slider editable pin min="{{-pitchPctMax}}" max="{{pitchPctMax}}" value="{{pitch}}"></paper-slider>
  </template>

  <script>
    Polymer('pitch-slider', {

      // hints
      minBpm: 0,
      maxBpm: 0,
      pitch: 0,
      pitchPctMax: 8,

      observe: {
        'global.bpm': 'globalBpmChanged',
        'global.song': 'globalSongChanged'
      },

      globalSongChanged: function(oldSong, song) {
        if (!song || !song.bpm) return;
        if (this.global.bpm == 0) {
          this.global.bpm = song.bpm;
        } else {
          var pitch = this.global.bpm / song.bpm;
          pitch = (pitch - 1) * 100;
          if (pitch > this.pitchPctMax) pitch = this.pitchPctMax;
          if (pitch < -this.pitchPctMax) pitch = -this.pitchPctMax;
          this.pitch = pitch;
        }
      },

      globalBpmChanged: function(oldBpm, bpm) {
        this.minBpm = this.global.bpm * (100 - this.pitchPctMax) / 100;
        this.maxBpm = this.global.bpm * (100 + this.pitchPctMax) / 100;
      }
    });
  </script>
</polymer-element>