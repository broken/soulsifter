import { css, html, LitElement } from "@polymer/lit-element";

import "./genre-list-item.js";
import { GenresMixin } from "./mixin-genres.js";

class GenreList extends GenresMixin(LitElement) {
  render() {
    let genreListItems = this.genreParents.map(g => html`<genre-list-item .genre="${g}" @genre-toggle="${this.toggleGenre}" ?optionsmenu="${this.optionsMenu}"></genre-list-item>`);
    return html`
      ${genreListItems}
      <!-- genre-list-item genre="[[item]]" on-genre-select="_selectGenre" single-select="[[singleSelect]]" main="[[main]]"></genre-list-item -->
      <paper-fab mini icon="add" on-click="_createGenre" hidden$="[[!main]]"></paper-fab>
    `;
  }

  static get properties() {
    return {
      genreParents: { type: Array },
      singleSelect: { type: Boolean },
      optionsMenu: { type: Boolean },
    }
  }

  constructor() {
    super();
    this.genreParents = ss.Style.findAllParents().sort((a, b) => a.name.localeCompare(b.name));
    this.singleSelect = false;
    this.main = false;
    this.genres = [];
  }

  genresChanged(genres) {
    this.genres = genres;
    for (var i = 0, childNodes = this.shadowRoot.querySelectorAll('genre-list-item');
         i < childNodes.length; ++i) {
      childNodes[i].selectIffInArray(this.genres);
    }
  }

  toggleGenre(e) {
    try {
      for (var i = 0; i < this.genres.length; ++i) {
        if (this.genres[i].id == e.detail.genre.id) {
          this.genres.splice(i, 1);
          return;
        }
      }
      // var g = new ss.Style(detail.genre);
      this.genres.push(e.detail.genre);
    } finally {
      if (this.optionsMenu) this.changeGenres(this.genres);
      // this.genresChanged(this.genres);
    }
  }

    // _createGenre(e, detail, sender) {
    //   var genre = new ss.Style();
    //   this.fire('page-genre-edit', {genre: genre});
    // }

  static get styles() {
    return [
      css`
        :host {
          padding: 0 0 20px 0;
          height: 100%;
          overflow-x: hidden;
          overflow-y: scroll;
        }
        paper-fab {
          bottom: 15px;
          position: relative;
          left: 182px;
        }
      `
    ];
  }
}

window.customElements.define('genre-list', GenreList);
