import { css, html, LitElement } from "@polymer/lit-element";

import "./genre-list-item.js";
import { GenresMixin } from "./mixin-genres.js";

class GenreList extends GenresMixin(LitElement) {
  render() {
    let genreListItems = this.genreParents.map(g => html`<genre-list-item .genre="${g}"></genre-list-item>`);
    return html`
      ${genreListItems}
      <!-- genre-list-item genre="[[item]]" on-genre-select="_selectGenre" single-select="[[singleSelect]]" main="[[main]]"></genre-list-item -->
      <paper-fab mini icon="add" on-click="_createGenre" hidden$="[[!main]]"></paper-fab>
    `;
  }

  static get properties() {
    return {
      genreParents: { type: Array },
      singleSelect: { type: Boolean },
      main: { type: Boolean },
    }
  }

  constructor() {
    super();
    this.genreParents = ss.Style.findAllParents().sort((a, b) => a.name.localeCompare(b.name));
    this.selection = [];
    this.singleSelect = false;
    this.main = false;
  }

  genresChanged(genres) {
    for (var i = 0, childNodes = this.shadowRoot.querySelectorAll('genre-list-item');
         i < childNodes.length; ++i) {
      childNodes[i].selectIffInArray(this.genres);
    }
  }

  selectGenre(e) {
    try {
      for (var i = 0; i < this.selection.length; ++i) {
        if (this.genres[i].id == e.detail.genre.id) {
          this.genres.splice(i, 1);
          return;
        }
      }
      var g = new ss.Style(detail.genre);
      this.genres.push(g);
    } finally {
      this.genresChanged(this.genres);
    }
  }

    // _createGenre(e, detail, sender) {
    //   var genre = new ss.Style();
    //   this.fire('page-genre-edit', {genre: genre});
    // }

  static get styles() {
    return [
      css`
        paper-fab {
          bottom: 15px;
          position: relative;
          left: 182px;
        }
      `
    ];
  }
}

window.customElements.define('genre-list', GenreList);
